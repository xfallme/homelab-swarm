- name: Set Docker secrets for doco-cd
  hosts: swarm01

  tasks:
    - name: Create Docker secret for doco-cd - Git access token
      docker_secret:
        name: git_access_token
        data: "{{ lookup('community.general.onepassword', 'GitOps Swarm doco-cd GH Access Token', field='credential', vault='Hosting') }}"
        state: present
    
    - name: Create Docker secret for doco-cd - 1Password service account token
      docker_secret:
        name: 1password_service_account_token
        data: "{{ lookup('community.general.onepassword', 'Service Account Auth Token: Swarm', field='credential', vault='Hosting') }}"
        state: present

    - name: Create Docker secret for doco-cd - Webhook secret
      docker_secret:
        name: webhook_secret
        data: "{{ lookup('community.general.onepassword', 'GitOps Swarm doco-cd Webhook Secret', field='credential', vault='Hosting') }}"
        state: present