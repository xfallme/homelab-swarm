services:
  whoami:
    image: traefik/whoami:v1.10.4
    networks:
      - proxy_network
    deploy:
      replicas: 3
      labels:
        caddy_1: whoami.$INTERNAL_DOMAIN
        caddy_1.reverse_proxy: "{{upstreams 80}}"
        caddy_2: https://whoami.$EXTERNAL_DOMAIN:44443
        caddy_2.reverse_proxy: "{{upstreams 80}}"
        caddy_3: whoami.$EXTERNAL_DOMAIN
        caddy_3.reverse_proxy: "{{upstreams 80}}"

networks:
  proxy_network:
    external: true